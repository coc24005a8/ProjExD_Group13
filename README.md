# 星のこうかとん(仮)

## 実行環境の必要条件
* python >= 3.10
* pygame >= 2.1

## ゲームの概要
* こうかとん(仮)を操作し、敵を避け・倒しながらゴールを目指せ！！

## ゲームの遊び方
* 矢印キーで移動、スペースキーでジャンプ、Pでパンチ
* こうかとん(仮)の体力が0になったら敗北

## ゲームの実装
### 共通基本機能
* 背景画像と主人公キャラクターの描画
* ヒットポイント
* 重力

### 分担追加機能
自分：カジノをモチーフにした敵キャラをを吸収してコピーした主人公の、
　　  見た目もカジノをモチーフにした姿を作成
     攻撃方法を作成、攻撃方法はランダムで攻撃のレベルが変わり稀に超強い攻撃が出る、ギャンブル要素を入れた
* 変身後の姿と攻撃(担当: 小林 入江 相川 ): こうかとん(仮)は特殊な敵を吸い込んで変身する。変身後の攻撃と姿を保持したクラス。
* 敵吸収機能(担当: 松永): 敵を吸収する判定や九州時の動作を保持するクラス 
* 変身用敵キャラクター(担当: 不破): 特殊な敵の行動や攻撃を保持するクラス

### ToDo
- [ ] ドックストリングや型ヒントの設定
- [ ] スクロール機能の実装
- [ ] プレイヤーや地形を画像に変更
- [ ] ホバリング機能の実装
 
### メモ
* 定数は大文字英数字「例:PLAYER_SPEED」,クラス名はキャメルケース「例:PlayerAttack」,関数名・変数はスネークケース「例:player_speed」 
* 関数について、仮引数には型ヒントをつけること,関数アノテーション(例の右端のやつ)をつけること, ドックストリングをつけること「例: def extend_stage(stage_width: "int") -> None: """ 引数: マップの・・・ """」
* コメントは#から1マス開けるといいよ「例: num # 敵の数」



* 今上がってる候補「カービィ」「シューティング(こうかとん)」
* 第一候補「カービィ」
* １: 横スクロールのゲーム。地面と敵を配置し、ゴールを目指す。
* 2:敵 こうかとん(イラスト)を配置、カービィっぽいやつを主人公に
* 3: 必須機能(横スクロール、地形判定、重力、ジャンプ) 特定機能(敵吸込、ホバリング)、追加機能(能力(※コードが大きく異なるような物: ファイアー、ボム、クラッシュ、スロット))
* 3-1:具体的実装方法 変身時、変身前カービィを消し、新たに返信スタンス
* ジャンル「シューティング」「パズル」「賭け事」

* 基本機能: １.スコア(優先度?,難易度1) 2.HP(優先度3,難易度1~2) 3.地形(優先度3,難易度?) 4.ゴール(優先度3,難易度1) 5.ホバリング(優先度1,難易度) 7.BGM(優先度1,難易度1) 9.敵(挙動も) 10.画像(敵、ゴール、背景)　11.廃棄
* 
* 追加機能: 敵の行動
<<<<<<< HEAD

C0A24223.不破太一
爆弾の敵の追加：
その敵から攻撃手段である爆弾の投擲を追加
地面をすり抜けて落ちないように地面との当たり判定を追加

2.追加した内容
炎の敵・投擲物・投擲物の動き
スロットの敵・投擲物・投擲物の動き
追加した敵のブロックとの当たり判定
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
C0C24005:入江諒
・カービィの攻撃アクションを3種類（ファイアボール、ファイアブレス、ファイアクラッシュ）実装し、それぞれZ/X/Cキーで発動できるようにした。
・ファイアボールはバウンドする物理挙動を持ち、進行方向に飛んで一定時間で消えるようにした。
・ファイアブレスは口元から連続して発射され、炎らしい見た目になるように画像やエフェクトを工夫した。
・ファイアクラッシュは範囲攻撃エフェクトを追加し、クールタイムなしで何度でも発動できるようにした。
・すべての攻撃エフェクトがカービィの口元から発射されるように座標調整を行った。
=======

# 個人実装機能まとめ (C0C24001)

## 実装者
- 学籍番号: C0C24001
- ブランチ: C0C24001/kirby_bom

## 実装した機能: ボムコピー能力システム

### ⚠️ 重要: カービィのコピー能力として実装
この機能は**カービィが爆弾を持つ敵を吸い込んだ後に使用できる能力**として実装されています。
- 初期状態では能力を使用できません
- 爆弾敵を吸い込むことで能力を取得します
- チームメンバーの吸い込み機能との連携が必要です

---

## 1. ボムコピー能力システム（カービィ連携機能）

### C0C24001_BombAbility クラス
**説明**: カービィのコピー能力を管理するクラス

**機能**:
- `has_ability`: 能力の所持状態を管理（初期値: False）
- `activate()`: 爆弾敵を吸い込んだ時に呼び出される
- `deactivate()`: 能力を失った時に呼び出される
- `use_ability()`: Bキー押下時に爆弾を生成

**操作方法**:
- **Bキー**: 爆弾設置（能力所持時のみ、重力で落下）
- **Shift+Bキー**: 爆弾投擲（能力所持時のみ、放物線軌道）
- **Kキー**: 近くの爆弾をキック

---

## 2. 爆弾プロジェクタイルシステム

### C0C24001_BombProjectile クラス
**説明**: ボム能力で生成される爆弾オブジェクト

**物理演算機能**:
- **重力**: GRAVITY * 0.5（通常の半分の重力）
- **跳ね返り**: 壁や地面で減衰（係数: 0.3～0.5）
- **摩擦**: 地面での減速処理（係数: 0.9）
- **衝突判定**: ブロックとの詳細な物理衝突

**爆発システム**:
- 導火線時間: 3.0秒（設置から爆発まで）
- 爆発範囲: タイルサイズの3倍（半径120px）
- 爆発エフェクト表示時間: 0.5秒

---

## 3. ビジュアルエフェクト

### プレイヤー画像システム
- **ファイル**: `img/bom1.png`
- **機能**:
  - 左右反転アニメーション
  - 透過処理対応（smoothscale使用）
  - サイズ: タイルの2.5倍（大きめに表示）
  - 足元の地面接地調整（0.75倍オフセット）

### 爆弾画像
- **ファイル**: `img/bom3.png`
- **説明**: 爆弾オブジェクトの見た目

### 爆発エフェクト（GIFアニメーション）
- **ファイル**: `img/bakuha.gif`
- **技術**:
  - PILライブラリで全フレーム読み込み
  - 20fpsでアニメーション再生（0.05秒/フレーム）
  - 爆発範囲に合わせて自動スケーリング

### 背景画像
- **ファイル**: `img/haikei.jpg`
- **説明**: ゲーム背景として画面全体に表示

---

## 4. サウンドシステム

### 爆発音
- **ファイル**: `bgm/bom.mp3` または `img/bom.mp3`
- **説明**: 爆弾が爆発した瞬間に再生

### BGM（背景音楽）
- **ファイル**: `bgm/music.ogg`（推奨）
- **対応形式**: OGG, WAV, MP3
- **再生**: ループ再生、音量30%

---

## 依存関係

### 必須ライブラリ
```bash
pygame >= 2.6.1
pillow >= 10.0.0  # GIFアニメーション用
```

インストール:
```bash
pip install pygame pillow
```

### 必須ファイル構成
```
ex5/
├── base.py
├── img/
│   ├── bom1.png      # プレイヤー画像
│   ├── bom3.png      # 爆弾画像
│   ├── bakuha.gif    # 爆発エフェクト
│   └── haikei.jpg    # 背景画像
└── bgm/
    ├── bom.mp3       # 爆発音
    └── music.ogg     # BGM
```

---

## コード構造

### クラス一覧

#### C0C24001_BombAbility
カービィのボムコピー能力を管理
```python
# 初期化
ability = C0C24001_BombAbility()

# 能力取得（吸い込み機能から呼び出し）
ability.activate()

# 能力使用
bomb = ability.use_ability(player_rect, player_facing_right, "place")
```

#### C0C24001_BombProjectile
爆弾オブジェクトの物理演算と描画
```python
# 生成
bomb = C0C24001_BombProjectile(x, y, velocity_x=0, velocity_y=1)

# 更新（物理演算と爆発判定）
exploded = bomb.update(block_rects)

# 描画
bomb.draw(screen, bomb_image, explosion_frames)

# 爆発終了確認
if bomb.is_explosion_finished():
    # 爆弾を削除
```

### 定数（個人実装分）
```python
C0C24001_BOMB_FUSE_TIME = 3.0           # 導火線時間
C0C24001_BOMB_EXPLOSION_DURATION = 0.5  # 爆発表示時間
C0C24001_BOMB_EXPLOSION_RADIUS = 120    # 爆発範囲
```

### 変数命名規則
すべての個人実装変数・関数には `c0c24001_` または `C0C24001_` プレフィックスを使用:
```python
c0c24001_bomb_ability        # 能力マネージャー
c0c24001_bombs               # 爆弾リスト
c0c24001_bomb_image          # 爆弾画像
c0c24001_explosion_frames    # 爆発アニメーションフレーム
```

---

## マージ時の注意点

### 🔴 必須: 吸い込み機能との連携

**吸い込み機能実装者への依頼**:
爆弾を持つ敵を吸い込んだ時に、以下のコードを呼び出してください:

```python
# 敵を吸い込んだ時の処理内で
if inhaled_enemy.type == "BOMB_ENEMY":  # 爆弾敵の判定
    c0c24001_bomb_ability.activate()  # ボム能力を取得
    print("【ボム能力を取得しました!】")
```

**能力を失う処理**（オプション）:
```python
# ダメージを受けた時など
c0c24001_bomb_ability.deactivate()
```

### 1. キーバインディングの競合確認
現在使用中のキー:
- **Bキー**: 爆弾設置/投擲（能力所持時のみ）
- **Kキー**: 爆弾キック
- **Shift+B**: 爆弾投擲（能力所持時のみ）

⚠️ 他のメンバーが同じキーを使用している場合は調整が必要です。

### 2. テストモードの削除
マージ前に以下の行を**必ず削除**してください:
```python
# テスト用: 能力を初期状態で有効化（実際のゲームでは敵を吸い込んで取得）
# マージ時は、吸い込み機能実装者がc0c24001_bomb_ability.activate()を呼び出す
c0c24001_bomb_ability.activate()  # ← この行を削除
print("【テストモード】爆弾能力が有効化されました。マージ時はこの行を削除してください。")  # ← この行を削除
```

### 3. ファイルの配置確認
`img/`フォルダと`bgm/`フォルダが正しく配置されているか確認してください。

### 4. コードのマーキング
個人実装部分は以下のコメントでマークしています:
```python
# ========================================
# 個人実装: ボムコピー能力システム (C0C24001)
# ========================================
```

---

## テスト方法

### 前提条件
現在はテストモードで能力が有効化されています。
マージ後は吸い込み機能で爆弾敵を吸い込む必要があります。

### テストケース

1. **能力取得テスト** (マージ後)
   - 爆弾敵を吸い込む
   - 「【ボム能力を取得!】」と表示されることを確認

2. **爆弾設置テスト**
   - Bキーを押す
   - 爆弾が足元に設置され、重力で落下することを確認
   - 3秒後に爆発することを確認

3. **爆弾投擲テスト**
   - Shift+Bキーを押す
   - 爆弾が放物線を描いて飛ぶことを確認
   - プレイヤーの向きに応じて投擲方向が変わることを確認

4. **爆弾キックテスト**
   - 爆弾を設置して静止させる
   - 爆弾の近くでKキーを押す
   - 爆弾が蹴られて転がることを確認

5. **サウンドテスト**
   - 爆発音が再生されることを確認
   - BGMがループ再生されることを確認

6. **物理演算テスト**
   - 爆弾が壁や地面で跳ね返ることを確認
   - 地面での摩擦で減速することを確認
   - 画面外に出ないことを確認

7. **能力なし状態テスト** (マージ後)
   - 能力を持っていない状態でBキーを押す
   - 何も起こらないことを確認

---

## 既知の問題

- 特になし
- テストモードの削除を忘れないこと

---

## 今後の拡張案

- 爆発による敵へのダメージ処理（衝突判定の追加）
- 連鎖爆発システム（爆発範囲内の爆弾を誘爆）
- 爆弾の種類追加（時限爆弾、リモート爆弾等）
- 能力強化アイテム（爆発範囲拡大、導火線時間短縮）
- スコア加算システム（爆発で敵を倒した時）

---

## トラブルシューティング

### Pillowがインストールされていない
```bash
pip install pillow
```

### GIFアニメーションが表示されない
- `img/bakuha.gif`が存在するか確認
- Pillowがインストールされているか確認
- デフォルトの円形エフェクトが表示されます

### BGMが再生されない
- OGG形式の使用を推奨: `bgm/music.ogg`
- MP3形式は互換性に問題がある場合があります
- [変換サイト](https://convertio.co/ja/mp3-ogg/)でOGGに変換してください

### 能力が使えない（マージ後）
- 爆弾敵を吸い込んで能力を取得してください
- `c0c24001_bomb_ability.activate()`が呼び出されているか確認

---

## 連絡先
質問や問題がある場合は、C0C24001まで連絡してください。
>>>>>>> C0C24001/kirby_bom
>>>>>>> d95ebdd41f56b3bafeeabb9ce7effafcd2b61bf7
>>>>>>> 43d38fe753659f514415490b213a25362b4aa1f8
